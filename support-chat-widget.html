{% comment %}
  Renders a support chat widget button.
  Accepts:
  - class: {String} a class to be added to the <div> element (optional).
  - chat_page_url: {String} the URL of the chat page to be displayed in the popup (required).

  Usage:
  {% render 'support-chat-widget',
    class: 'my-class',
    chat_page_url: '/path-to-your-chat-page'
  %}
{% endcomment %}
{% if customer %}
  {% for order in customer.orders %}
    {% for items in order.line_items %}
      {% if items.product.id == 7470809809105 %}
        {% assign allowed = true %}
      {% endif %}
    {% endfor %}
  {% endfor %}
{% endif %}
{% if allowed %}
<!-- Modal -->
<div id="chat-modal" class="chat-modal">
  <img src="{{ 'https://cdn.shopify.com/s/files/1/0576/2596/8849/files/chatbot-icon.svg?v=1724397302' }}" width="46px" height="46px" alt="Chat Icon" class="bot-icon" />
  <div id="chat-modal-content" class="chat-modal-content">
    <p class="modal-text">Hi!... Want to chat about Kartclass?
I'm here to help you explore KartClass. 
Let's get started! ðŸš€</p>
    <a href="{{ chat_page_url }}" target="_blank" class="chat-link">Click here for support</a>
  </div>
</div>

<!-- Mobile Modal -->
<a href="{{ chat_page_url }}" target="_blank" class="mobile-chat-modal">
  <img src="{{ 'https://cdn.shopify.com/s/files/1/0576/2596/8849/files/green-bot-icon.svg?v=1724987111' }}" width="60px" height="60px" alt="Chat Icon" class="mobile-bot-icon" />
  <span class="mobile-chat-link">Click here for support</span>
</a>
{% endif %}
<style>
/* Modal styles for desktop */
#chat-modal {
    display: flex;
    position: fixed;
    bottom: 47px;
    right: 47px;
    width: 344px;
    height: 162px;
    border-radius: 5px;
    background: rgba(0, 147, 76, 0.69);
    padding:32px;
    z-index: 10000;
    justify-content: center;
}

#chat-modal-content {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction:column;
    justify-content: center;
}

.modal-text {
    text-shadow: 0px 0px 4px rgba(0, 0, 0, 0.40);
    font-family: Arial;
    font-size: 16px;
    font-style: normal;
    font-weight: 400;
    line-height: 22px;
    color:#ffffff;
    margin:0 !important;
}

.chat-link {
    text-shadow: 0px 0px 4px rgba(0, 0, 0, 0.40);
    font-family: Arial;
    font-size: 16px;
    font-style: normal;
    font-weight: 400;
    line-height: 22px;
    color: #ffffff;
    text-decoration: underline;
    margin-top:10px;
}

.bot-icon {
    position:absolute;
    top:-23px;
    left:15px;
}

/* Mobile chat widget styles */
.mobile-chat-modal {
    display: none !important;
    position: fixed;
    bottom: 68px;
    right: 32px;
    height: 60px;
    background: #00934C;
    border-bottom-left-radius:300px;
    border-top-left-radius:300px;
    border-bottom-right-radius:5px;
    border-top-right-radius:5px;
    z-index: 10000;
    display: flex;
    align-items: center;
    padding: 0;
    text-decoration: none;
    box-shadow: 0px 0px 9px 0px rgba(255, 255, 255, 0.23);
}

.mobile-bot-icon {
    margin: 0;
}

.mobile-chat-link {
   color: #ffffff;
   text-shadow: 0px 0px 4px rgba(0, 0, 0, 0.40);
   font-family: Arial;
   font-size: 16px;
   font-style: normal;
   font-weight: 400;
   line-height: 22px;
   text-transform: uppercase; 
   padding-left: 32px;
   padding-right: 32px; 
}

/* Responsive Styles */
@media screen and (max-width: 1180px) {
  /* Hide desktop modal on mobile */
  #chat-modal {
    display: none !important;
  }

  /* Show mobile modal on mobile */
  .mobile-chat-modal {
    display: flex !important;
  }
}

@media screen and (min-width:751px) and (max-width:1024px) {
  #chat-modal{
    bottom: 30px;
    right: 40px;
    width: 320px;
   }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('chat-modal').style.display = 'flex';
});
</script>
